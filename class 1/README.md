
# 분산원장과 블록체인
> http://www.mangoresearch.co/blockchain-vs-distributed-ledger-technology-dlt/

* 상호 신뢰기반 구축 기술
* 위변조 불가
* 어플리케이션 적용 가능
* DLT is Distributed Ledger Technology
* Blockchain was the first fully functional Distributed Ledger Technology
* Blockchain is a type of DLT
* All DLTs are NOT Blockchains. But all Blockchains are DLTs
* Not all the cryptocurrencies are blockchain implementations.
  * Radix, IOTA and R3 Corda are examples of DLTs that are NOT blockchains.
  > ![Distributed Ledger Technology](img/dlt.png)

# 비트코인

## 최초의 블록체인

* 1990년대 부터 연구되기 시작
* 비트코인 등장 이전에 HASHCASH, DIGICASH, BIT GOLD, B-MONEY 와 같은 전자/암호 화폐를 시도
* 2007년 부터 시작되어 2008년에 사토시 나카모토에 의해 최초의 블록체인이 개념화
* 사토시 나카모토를 주축으로 오픈소스로 구현된 **비트코인**(original bitcoin client)은 2009-01-03 18:15(UTC)에 제네시스 블록을 시작

## 블록이란?

* 필수정보
  * 블록해시
  * 이전블록해시
  * 머클루트
  * 버전, 타임스탬프, Bits(Difficulty), Nonce
* 필수정보와 검증된 거래정보가 원장에 기록되기 위해 마이너에 의해 블록으로 생성
* 마이너는 높은 수수료를 지불한 거래를 포함하여 기록될 거래를 선택 가능
  * ViaBTC 마이닝풀에서 운영중인 트랜잭션 가속기 - https://pool.viabtc.com/tools/txaccelerator/
    * 무료 또는 유료 서비스가 가능
    * 네트워크에 트랜잭션 정체가 심할 경우 사용 가능
    * ViaBTC 마이닝풀에서 채굴에 성공할 경우, 서비스 수수료를 받고 우선권을 부여하는 방식 (채굴 못하면 도루묵)
* 비트코인 블록 용량은 1MB 로 제한됨 (블록체인마다 제한점이 다름)
  * 용량 제한으로 기록가능한 거래정보도 제한
  * 비트코인의 블록생성 기준인 10분과 용량제한을 가지고 tps(초당 트랜잭션 처리량)를 추정 가능

## 체인이란?

* 모든 블록은 이전블록해시를 기록
* 현재 블록에서 이전블록해시를 계속 찾아가면 제네시스 블록에 도달
* 현재 블록해시는 다음블록의 이전블록해시에 기록되어 연결
  > ![BlockChain](img/blockchain.png)

## 시스템 구성

### Genesis Block

* 제네시스 블록은 소스에 하드코딩
* 블록체인 상 #0(첫번째) 마이닝 블록이며 체인의 맨 앞에 위치
* 9년전인 2009-01-03 18:15(UTC) 에 시작
* https://blockchair.com/bitcoin/block/0

### 노드

* 프로젝트의 공식 지갑(Wallet)이 노드에 해당
  * 개인키와 공개키(비트코인 수신 주소) 목록을 관리
  * 거래(트랜잭션)와 블록을 검증하며 직접 생성(마이닝)도 가능
* **P2P 네트워크**의 피어
  * 최초 P2P 네트워크의 접속점은 seed dns 가 소스에 하드코딩
  * Standalone 이나 독립된 피어 네트워크로 구성하면 **독립된** 코인이 제네시스 블록 부터 시작 가능
  * 노드의 실행 옵션에 의해 메인넷, 테스트넷, Standalone 으로 구분하여 구동
* **트랜잭션**, **검증**, **마이닝**
  * 거래에 의해 직접 생성하거나 타 노드에서 전파된 거래를 검증하고 멤풀에 등록, 연결된 피어에 전파
  * 마이닝에 의해 직접 생성하거나 타 노드에서 전파된 블록을 검증하고 로컬 원장에 기록, 연결된 피어에 전파
* 노드의 종류
  * 풀 노드
    * 모든 거래가 담겨 있는 블록체인의 최신 완성본을 보관 (제네시스 블록부터 최신 블록까지)
    * 타 시스템 의존이나 신뢰 없이 모든 거래에 대해 독립적으로 검증
    * 2017년 기준으로 수십기가의 디스크가 필요하고, 최신 블록까지 동기화에 몇일이 소요
  * 라이트웨이트/단술지불검증(SPV) 노드 
    * 스마트폰, 태블릿, 임베디드 시스템 등의 리소스가 제한적인 곳에서 가동되도록 설계
    * 블록 헤더만 다운로드 하며 풀 노드에 비해 1000배 정도 작다
    * 거래 정보가 없기 때문에 풀 노드에서 필요한 정보를 수신하여 동작
      * 연결된 풀 노드가 신뢰 할 수 없다면 취약점이 됨.
  * 채굴 노드
    * 새로운 블록의 생성 여부
    * 전문 채굴 하드웨어는 풀 노드와 연결되어 동작
* 노드 어플리케이션
  * Bitcoin core(C++) - https://github.com/bitcoin/bitcoin
  * Bitcore(Nodejs) - https://github.com/bitpay/bitcore/
  * btcd(Golang) - https://github.com/btcsuite/btcd
  * 프로토콜만 지키면 누구든지 커스텀 노드 제작이 가능
  * 유틸리티
    * pycoin(Python) - https://github.com/richardkiss/pycoin

### 보상

* 해시파워로 보안성을 증명(PoW)한 마이너에게 코인 보상
* 보상액은 블록당 50BTC 를 시작으로 매 4년마다 50%씩 하향 (**반감기**)
* 총 발행 가능량은 20,999,999.9769개로 고정 (미래에 합의로 조정 가능)
* 총 발행 후 마이너는 거래 수수료 만을 보상으로 획득
* 코인 이코노미
* Projected Bitcoins Long Term - https://en.bitcoin.it/wiki/Controlled_supply#Projected_Bitcoins_Long_Term
  > ![Reward](img/supply.png)

## Proof of Work

* 비트코인의 블록 채굴 방식, "작업증명" 이라고 부름
* 현재도 여전히 비트코인, 이더리움, 비트코인캐시 등 수많은 코인에서 사용
* 가장 검증되고 신뢰된 방식
  > 이론을 바탕으로 현실적으로 오랫동안 해킹없이 운영되며 신뢰도를 쌓음
* 블록의 헤더와 임의의 숫자를 반복적으로 해싱하여 답을 찾아낸 첫번째 채굴자가 승자가 되는 구조
* 각 채굴자는 P2P 네트워크로 부터 새로운 블록을 받게 되면 즉시 새로운 블록으로 PoW 를 재시작
* 무작위 이기 때문에 블록생성 주기는 약간 유동적
* 마이닝의 방법은 CPU > GPU > FGA > ASIC 방식으로 변화 했고, 전력대비 해시레이트를 높이는게 목표
  > ![PoW](img/pow.jpg)
* 난이도 : 주어진 목표값 아래 해시(블록)를 찾는 것이 얼마나 어려운지를 측정한 값
* 난이도 목표값 : 헤더의 nBits 이며, 네트워크 내의 해싱파워로 약 10분마다 블록을 찾을 수 있는 난이도
  * 최소값 : 1 (시작값이며 제네시스 블록의 헤더 값)
  * 최대값 : 0x00000000FFFF0000000000000000000000000000000000000000000000000000 (상수)
* 난이도 재설정 : 매 2016블록(약 2주) 마다 이전 2016블록의 해싱파워를 기준으로 재계산
  * 이전 2016블록 채굴이 2주보다 빠르면 난이도 상승, 반대면 하락
  > ![Difficult target](img/nbits.png)
* 그래프상 2곳에서 난이도가 하향 되었는데 해시파워가 가격상승으로 채산성이 높아 졌던 비트코인캐시로 집중되어 일시적 하향된 경우
  > ![Difficulty](img/difficulty.png)

## 해싱(블록찾기)

* 해시파워는 파일 용량 단위와 동일한 킬로/메가/기가/테라해시 등의 단위가 존재
* 1메가 해시파워는 초당 1,000,000번의 해싱이 가능
* 해싱
  * 비트코인 네트워크 총 HashRate는 35~40ExaHashes/s
  * 최강의 비트코인 하드웨어 채굴기 Antminer S9은 대당 14TeraHashes/s
  > ![Block Structure](img/block.png)

# 비트코인 블록이 만들어지는 과정

## 트랜잭션 (거래)

* 비트코인 주소A 에서 주소B 로 소유권 이전
  * 정확한 부분은 UTXO 에 대해서 알아야 함.
* 발생 노드에서 유효성 검증을 거쳐 네트워크에 브로드캐스팅
* 모든 노드는 트랜잭션이 수신되면 생성과 동일하게 유효성을 검증

## 트랜잭션 풀 (메모리풀)

* 검증된 트랜잭션이 원장에 기록되기 전에 보관되는 곳
* 모든 노드는 블록체인과 마찬가지로 동일한 트랜잭션 풀을 각각 가짐

## 후보 블록

* 이전 블록의 해시와 연결된 유효한 블록 헤더와 바디를 가진 블록
* 채굴자가 해싱을 완료해야 네트워크에 전파 가능한 정식 블록이 됨
* 거래 채우기
  * 코인베이스
    * #0 트랜잭션에 해당하며 채굴 승자가 될 경우 지급 받을 보상을 직접 자신의 비트코인 주소로 송금 하는 것
    * 모든 노드에 의해서 재 검증됨 (주요한 것은 보상 코인 수량)
  * 제한된 블록용량 만큼 트랜잭션 풀에서 블록 바디에 기록 (빈 블록 바디도 가능하나 트랜잭션수수료도 가지기 때문에...)
  * 트랜잭션은 채굴자가 선택 가능하며 트랜잭션수수료는 마이너 몫이기 때문에 높은 값을 우선 선택

## 해싱

* 블록 해답 찾기

## 브로드캐스팅

* 생성/준비된 블록을 네트워크에 브로드캐스팅

## 수신 노드의 역할

* 생성과 동일한 절차로 유효성 검증
* 완료된 해싱 값은 Nonce 에 기록되어 전파 되기 때문에 즉시 모든 유효성 검증 가능

# 인사이드 비트코인

## PaperWallet
 * https://paperwalletbitcoin.com/?=BTCPW

## 주소
  > ![Address](img/bitcoin_addr.png)

## UTXO / Spending(송금)
  > ![UTXO](img/utxo.jpg)


# 기타

## 이더리움
 - SmartContract
  - 불변의 계약
  - 스마트컨트랙트(1994년 Nick Schzabo가제창) 개념도실적용
  -  계약이만들어지면블록체인상에서는무조건이행을해야함
  - 중개자(Middle man)를믿지못하는환경에용이
 - Token 은 무엇인가?

## 스팀
 - 댄라이머가 개발, dpos 컨센서스, 이 후 dpos 로 eos 를 개발 (가장 유망한 블록체인 중 하나)
 - steem db는 도대체 먼가?
 - steemit 은 먼데?
 - 왜 이렇게 구린가?
 - https://steemit.com/coinkorea/@coolzero/sns-18-06-04
